# SPINE2 Configuration (17.4R1.16)

set version 17.4R1.16
set system host-name SPINE2

# Interfaces
set interfaces xe-0/0/3 unit 0 family inet address 172.16.23.0/31
set interfaces xe-0/0/4 unit 0 family inet address 172.16.24.0/31
set interfaces xe-0/0/5 unit 0 family inet address 172.16.25.0/31
set interfaces lo0 unit 0 family inet address 2.2.2.2/32

# Routing options
set routing-options router-id 2.2.2.2
set routing-options autonomous-system 65530
set routing-options forwarding-table export LB
set routing-options forwarding-table chained-composite-next-hop ingress evpn

# BGP Underlay (External)
set protocols bgp group UNDERLAY type external
set protocols bgp group UNDERLAY export Export-Lo
set protocols bgp group UNDERLAY local-as 64513
set protocols bgp group UNDERLAY multipath multiple-as
set protocols bgp group UNDERLAY neighbor 172.16.23.1 peer-as 64514
set protocols bgp group UNDERLAY neighbor 172.16.24.1 peer-as 64515
set protocols bgp group UNDERLAY neighbor 172.16.25.1 peer-as 64516

# BGP Overlay (Internal EVPN)
set protocols bgp group OVERLAY type internal
set protocols bgp group OVERLAY local-address 2.2.2.2
set protocols bgp group OVERLAY family evpn signaling
set protocols bgp group OVERLAY cluster 2.2.2.2
set protocols bgp group OVERLAY local-as 65530
set protocols bgp group OVERLAY multipath
set protocols bgp group OVERLAY neighbor 1.1.1.1
set protocols bgp group OVERLAY neighbor 3.3.3.3
set protocols bgp group OVERLAY neighbor 4.4.4.4
set protocols bgp group OVERLAY neighbor 5.5.5.5

# Policy-options
set policy-options policy-statement Export-Lo term 1 from protocol direct
set policy-options policy-statement Export-Lo term 1 from interface lo0.0
set policy-options policy-statement Export-Lo term 1 then accept
set policy-options policy-statement LB term 1 then load-balance per-packet
set policy-options policy-statement LB term 1 then accept
